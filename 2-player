<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Stickman 2-Player Fight</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif}
    body{background:#111;color:#f5f5f5;display:flex;justify-content:center;align-items:center;height:100vh}
    #wrapper{display:flex;flex-direction:column;align-items:center;gap:8px}
    canvas{border:2px solid #444;background:linear-gradient(#222 50%,#1a1a1a 50%);border-radius:8px;display:block}
    .ui{width:900px;display:flex;justify-content:space-between;align-items:center;font-size:14px}
    .health-bar{position:relative;width:260px;height:18px;border-radius:999px;border:2px solid #555;overflow:hidden;background:#333}
    .health-bar-fill{position:absolute;width:100%;height:100%;left:0;top:0;background:linear-gradient(90deg,#0f0,#ff0,#f00);transform-origin:left center}
    .label{font-weight:600;margin-bottom:2px}
    .player-label{display:flex;flex-direction:column;gap:2px}
    .center-text{text-align:center;font-size:13px;opacity:.8;line-height:1.4}
    .keys{font-size:12px;opacity:.9}
  </style>
</head>
<body>
<div id="wrapper">
  <div class="ui">
    <div class="player-label">
      <span class="label">Player 1 (Blue)</span>
      <div class="health-bar"><div id="hp1" class="health-bar-fill"></div></div>
      <span class="keys">Move: W/A/D — Punch: S</span>
    </div>
    <div class="center-text">
      <div>Stickman Fight</div>
      <div>First to drop HP to 0 loses.</div>
      <div>Press <b>R</b> to restart.</div>
    </div>
    <div class="player-label" style="align-items:flex-end;text-align:right">
      <span class="label">Player 2 (Red)</span>
      <div class="health-bar"><div id="hp2" class="health-bar-fill"></div></div>
      <span class="keys">Move: ↑/←/→ — Punch: ↓</span>
    </div>
  </div>
  <canvas id="game" width="900" height="500"></canvas>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const hpBar1=document.getElementById("hp1");
const hpBar2=document.getElementById("hp2");
const keys={};
window.addEventListener("keydown",e=>{keys[e.code]=true;if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.code))e.preventDefault()});
window.addEventListener("keyup",e=>keys[e.code]=false);

const GROUND_Y=canvas.height-60,GRAVITY=2000,MOVE_SPEED=380,JUMP_SPEED=850,FRICTION=.82;

class Player{
 constructor(o){Object.assign(this,o);this.hpMax=o.hp||100;this.hp=o.hp||100;this.vx=this.vy=0;this.attackTime=0;this.attackDuration=.15;this.attackCooldown=.23;this.isAttacking=false;this.hasDealtDamage=false;this.dead=false}
 reset(x,f){Object.assign(this,{x, y:GROUND_Y, vx:0, vy:0, hp:this.hpMax, facing:f, attackTime:0, isAttacking:false, hasDealtDamage:false, dead:false})}
 update(dt){
  if(this.dead)return;
  const l=keys[this.control.left],r=keys[this.control.right],u=keys[this.control.up],a=keys[this.control.attack];
  if(l&&!r){this.vx=-MOVE_SPEED;this.facing=-1}
  else if(r&&!l){this.vx=MOVE_SPEED;this.facing=1}
  else{this.vx*=FRICTION;if(Math.abs(this.vx)<10)this.vx=0}
  const onGround=this.y>=GROUND_Y-1;if(u&&onGround)this.vy=-JUMP_SPEED;
  if(a&&this.attackTime<=0){this.attackTime=this.attackDuration+this.attackCooldown;this.hasDealtDamage=false}
  if(this.attackTime>0){this.attackTime-=dt;this.isAttacking=this.attackTime>this.attackCooldown}else this.isAttacking=false;
  this.vy+=GRAVITY*dt;this.x+=this.vx*dt;this.y+=this.vy*dt;
  if(this.y>GROUND_Y){this.y=GROUND_Y;this.vy=0}
  if(this.x<20){this.x=20;this.vx=0}
  if(this.x+this.width>canvas.width-20){this.x=canvas.width-20-this.width;this.vx=0}
  if(this.hp<=0){this.hp=0;this.dead=true}
 }
 getAttackRect(){
  const reach=40,ph=30,cx=this.x+this.width/2,cy=this.y-this.height*.45;
  return{ x:this.facing===1?cx:cx-reach, y:cy-ph/2, width:reach, height:ph };
 }
 draw(c){
  const cx=this.x+this.width/2,hr=this.width*.7,headY=this.y-this.height,neckY=headY+hr*2,hipY=this.y-15;
  c.strokeStyle=this.color;c.lineWidth=5;c.lineCap="round";
  // head
  c.beg
