<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Stickman 2-Player Fight</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif}
    body{background:#111;color:#f5f5f5;display:flex;justify-content:center;align-items:center;height:100vh}
    #wrapper{display:flex;flex-direction:column;align-items:center;gap:8px}
    canvas{border:2px solid #444;background:linear-gradient(#222 50%,#1a1a1a 50%);border-radius:8px;display:block}
    .ui{width:900px;display:flex;justify-content:space-between;align-items:center;font-size:14px}
    .health-bar{position:relative;width:260px;height:18px;border-radius:999px;border:2px solid #555;overflow:hidden;background:#333}
    .health-bar-fill{position:absolute;width:100%;height:100%;left:0;top:0;background:linear-gradient(90deg,#0f0,#ff0,#f00);transform-origin:left center}
    .label{font-weight:600;margin-bottom:2px}
    .player-label{display:flex;flex-direction:column;gap:2px}
    .center-text{text-align:center;font-size:13px;opacity:.8;line-height:1.4}
    .keys{font-size:12px;opacity:.9}
  </style>
</head>
<body>
<div id="wrapper">
  <div class="ui">
    <div class="player-label">
      <span class="label">Player 1 (Blue)</span>
      <div class="health-bar"><div id="hp1" class="health-bar-fill"></div></div>
      <span class="keys">Move: W/A/D ‚Äî Punch: S</span>
    </div>
    <div class="center-text">
      <div>Stickman Fight</div>
      <div>First to drop HP to 0 loses.</div>
      <div>Press <b>R</b> to restart.</div>
    </div>
    <div class="player-label" style="align-items:flex-end;text-align:right">
      <span class="label">Player 2 (Red)</span>
      <div class="health-bar"><div id="hp2" class="health-bar-fill"></div></div>
      <span class="keys">Move: ‚Üë/‚Üê/‚Üí ‚Äî Punch: ‚Üì</span>
    </div>
  </div>
  <canvas id="game" width="900" height="500"></canvas>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const hpBar1=document.getElementById("hp1");
const hpBar2=document.getElementById("hp2");
const keys={};
window.addEventListener("keydown",e=>{keys[e.code]=true;if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.code))e.preventDefault()});
window.addEventListener("keyup",e=>keys[e.code]=false);

const GROUND_Y=canvas.height-60,GRAVITY=2000,MOVE_SPEED=380,JUMP_SPEED=850,FRICTION=.82;

class Player{
 constructor(o){Object.assign(this,o);this.hpMax=o.hp||100;this.hp=o.hp||100;this.vx=this.vy=0;this.attackTime=0;this.attackDuration=.15;this.attackCooldown=.23;this.isAttacking=false;this.hasDealtDamage=false;this.dead=false}
 reset(x,f){Object.assign(this,{x, y:GROUND_Y, vx:0, vy:0, hp:this.hpMax, facing:f, attackTime:0, isAttacking:false, hasDealtDamage:false, dead:false})}
 update(dt){
  if(this.dead)return;
  const l=keys[this.control.left],r=keys[this.control.right],u=keys[this.control.up],a=keys[this.control.attack];
  if(l&&!r){this.vx=-MOVE_SPEED;this.facing=-1}
  else if(r&&!l){this.vx=MOVE_SPEED;this.facing=1}
  else{this.vx*=FRICTION;if(Math.abs(this.vx)<10)this.vx=0}
  const onGround=this.y>=GROUND_Y-1;if(u&&onGround)this.vy=-JUMP_SPEED;
  if(a&&this.attackTime<=0){this.attackTime=this.attackDuration+this.attackCooldown;this.hasDealtDamage=false}
  if(this.attackTime>0){this.attackTime-=dt;this.isAttacking=this.attackTime>this.attackCooldown}else this.isAttacking=false;
  this.vy+=GRAVITY*dt;this.x+=this.vx*dt;this.y+=this.vy*dt;
  if(this.y>GROUND_Y){this.y=GROUND_Y;this.vy=0}
  if(this.x<20){this.x=20;this.vx=0}
  if(this.x+this.width>canvas.width-20){this.x=canvas.width-20-this.width;this.vx=0}
  if(this.hp<=0){this.hp=0;this.dead=true}
 }
 getAttackRect(){
  const reach=40,ph=30,cx=this.x+this.width/2,cy=this.y-this.height*.45;
  return{ x:this.facing===1?cx:cx-reach, y:cy-ph/2, width:reach, height:ph };
 }
 draw(c){
  const cx=this.x+this.width/2,hr=this.width*.7,headY=this.y-this.height,neckY=headY+hr*2,hipY=this.y-15;
  c.strokeStyle=this.color;c.lineWidth=5;c.lineCap="round";
  // head
  c.beginPath();c.arc(cx,headY+hr,hr,0,Math.PI*2);c.stroke();
  // body
  c.beginPath();c.moveTo(cx,neckY);c.lineTo(cx,hipY);c.stroke();
  // legs
  const legLen=38;
  c.beginPath();c.moveTo(cx,hipY);c.lineTo(cx-18,hipY+legLen);c.moveTo(cx,hipY);c.lineTo(cx+18,hipY+legLen);c.stroke();
  // arms
  const shoulderY=neckY+10,armLen=32;
  // back arm
  c.beginPath();c.moveTo(cx,shoulderY);c.lineTo(cx-this.facing*armLen*.6,shoulderY+armLen*.4);c.stroke();
  // front arm
  c.beginPath();c.moveTo(cx,shoulderY);
  if(this.isAttacking){c.lineTo(cx+this.facing*(armLen+12),shoulderY-4);}else{c.lineTo(cx+this.facing*armLen*.7,shoulderY+armLen*.2);}
  c.stroke();
  // fist when punching
  if(this.isAttacking){
    const fx=cx+this.facing*(armLen+12),fy=shoulderY-4;
    c.beginPath();c.arc(fx,fy,6,0,Math.PI*2);c.fillStyle=this.color;c.fill();
  }
 }
}

const p1=new Player({x:150,y:GROUND_Y,width:30,height:110,color:"#3aa8ff",facing:1,hp:100,control:{left:"KeyA",right:"KeyD",up:"KeyW",attack:"KeyS"}});
const p2=new Player({x:canvas.width-180,y:GROUND_Y,width:30,height:110,color:"#ff5555",facing:-1,hp:100,control:{left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",attack:"ArrowDown"}});

let lastTime=0,gameOver=false,winnerText="";

function overlap(a,b){return a.x<b.x+b.width&&a.x+a.width>b.x&&a.y<b.y+b.height&&a.y+a.height>b.y}
function hit(a,b){
  if(a.hasDealtDamage||!a.isAttacking)return;
  const ar=a.getAttackRect(),br={x:b.x,y:b.y-b.height,width:b.width,height:b.height};
  if(overlap(ar,br)){a.hasDealtDamage=true;b.hp-=12;b.vx=520*a.facing;b.vy=-520;}
}
function updateHP(){
  hpBar1.style.transform=`scaleX(${Math.max(0,p1.hp/p1.hpMax)})`;
  hpBar2.style.transform=`scaleX(${Math.max(0,p2.hp/p2.hpMax)})`;
}
function reset(){
  p1.reset(150,1);
  p2.reset(canvas.width-180,-1);
  gameOver=false;
  winnerText="";
  updateHP();
}
function bg(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.strokeStyle="#444";ctx.lineWidth=3;
  ctx.beginPath();ctx.moveTo(0,GROUND_Y+.5);ctx.lineTo(canvas.width,GROUND_Y+.5);ctx.stroke();
}
function drawEnd(){
  if(!gameOver)return;
  ctx.save();
  ctx.fillStyle="rgba(0,0,0,0.7)";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#fff";
  ctx.textAlign="center";
  ctx.font="38px system-ui";
  ctx.fillText(winnerText,canvas.width/2,canvas.height/2-40);
  ctx.font="26px system-ui";
  ctx.fillText("üëë KING ‚Äî Made by OfficialYaman üëë",canvas.width/2,canvas.height/2);
  ctx.font="18px system-ui";
  ctx.fillText("Press R to Restart",canvas.width/2,canvas.height/2+40);
  ctx.restore();
}
function loop(t){
  if(!lastTime)lastTime=t;
  const dt=(t-lastTime)/1000;lastTime=t;
  if(keys["KeyR"])reset();
  if(!gameOver){
    p1.update(dt);p2.update(dt);
    hit(p1,p2);hit(p2,p1);
    updateHP();
    if(p1.dead||p2.dead){
      gameOver=true;
      winnerText=p1.dead&&p2.dead?"Draw!":p2.dead?"Player 1 Wins!":"Player 2 Wins!";
    }
  }
  bg();p1.draw(ctx);p2.draw(ctx);drawEnd();
  requestAnimationFrame(loop);
}
reset();
requestAnimationFrame(loop);
</script>
</body>
</html>
